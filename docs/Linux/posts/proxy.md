## Set proxies in WSL2

It's really tough experience... The bugs and problems related to aspects of **Windows fire wall**, DNS, Clash...

### Windows fire wall

> [set inbound rules for WSL2 in FW](https://github.com/microsoft/WSL/issues/4171#issuecomment-929858850)
>
> [restore DNS auto-generation in WSL2](https://github.com/microsoft/WSL/issues/5420#issuecomment-646479747)
>
> [proxy scripts](https://gist.github.com/libChan/3a804a46b532cc326a2ee55b27e8ac19?permalink_comment_id=4618384)

The first problem I encountered is that 

- I tried to check the connectivity when I wanted to **ping** windows host machine from WSL2, there is no reply(very common). 
- Then I STFW and got this: [set inbound rules for WSL2 in FW](https://github.com/microsoft/WSL/issues/4171#issuecomment-929858850), but still not work.
- (After a bunch of time figuring out why,) I occationally found that actually the _Windows FW_ did not work, because I used _ESET_ (another security app).
- Thus I deleted _ESET_ and Windows FW's rules began to work (what a important milestone!) and I could ping the host from WSL.

### DNS

Then I noticed that my WSL2's DNS server had been changed (to 8.8.8.8) by myself before. But actually it should be auto-generated by `/etc/wsl.conf`.

According to [restore DNS auto-generation in WSL2](https://github.com/microsoft/WSL/issues/5420#issuecomment-646479747), I `rm /etc/resolv.conf` and reboot WSL2 (by running `wsl --shutdown` in windows command line), I finally can get a DNS server that is Windows Host (which is dynamically assigned and will change from time to time).

By now, I can ping or access web pages **within** GFW. The next step is to set up proxies in WSL2.

### Clash

I use _clash_ as my proxy app in Windows host. And I turned on **Allow LAN** to allow my WSL2 which is in host's LAN to connect with Clash.

And then I use this [proxy scripts](https://gist.github.com/libChan/3a804a46b532cc326a2ee55b27e8ac19?permalink_comment_id=4618384) to enable WSL2 to set up proxies as Clash in Windows host.

I used `wget` and `git clone` to the github and google, and I finally got **responses**!

### Summary

The network link topology is

WSL (via vEthernet(WSL))-> Windows --> Clash proxy server(at 7890) --> Internet 